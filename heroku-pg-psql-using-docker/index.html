<!doctype html><html><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://thefron.me/scss/main.min.ac25bf3c9498992c54b4930c803c61de3de905e51b61dc0bd43bd4c09ea63908.css><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-22237907-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><body><nav class="navbar is-dark" role=navigation aria-label="main navigation"><div class=container><div class=navbar-brand><a class="navbar-item title is-3" href=/>Thefron</a></div><div class=navbar-menu><div class=navbar-end><a class=navbar-item href=https://thefron.me/about/>About</a><a class=navbar-item href=https://thefron.me/posts/>Posts</a></div></div></div></nav><div id=content><main class="post section"><div class=container><div class=post-info></p></div><article><h2 class="post-title title is-1"><a href=https://thefron.me/heroku-pg-psql-using-docker/>Heroku Pg Psql Using Docker</a></h2><div class="post-content content"><p>최근 로컬 개발환경을 리셋하면서 redis, postgres 등 각종 개발 디펜던시를 설치하지 않고, 오직 docker만 이용해서 로컬 환경을 최대한 깔끔하게 유지하기로 마음먹었다(똥고집이다).</p><p>그런데 난관이 등장했으니,</p><p>프로덕션 배포 중인 heroku 앱의 postgres 디비 콘솔에 접근하기 위해 heroku toolbelt에서 제공하는 <code>heroku pg:psql</code> 커맨드를 자주 사용하는데, 이 때 로컬 경로의 <code>psql</code>을 이용한다는 것이다.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ heroku pg:psql
---&gt; Connecting to DATABASE_URL
sh: psql: command not found</code></pre></div><p>굳이 toolbelt를 쓰지 않고 <code>docker run -it --rm postgres psql</code> 커맨드에 적당히 credential을 넣어주면 되지만, 매번 credential을 알아오기도 귀찮고 heroku toolbelt를 썩히기도 아까워 해결책이 있을지 고민해봤다.
처음에는 간단히 alias를 걸면 될 줄 알았는데 heroku command에서 쉘 환경을 리셋시켜버려서 command not found가 떴다.</p><p>결국 아래와 같이 psql의 인자를 받아 docker 커맨드로 포워드하는 가짜 psql 프로그램을 <code>/usr/local/bin/psql</code>에 만들어 넣어서 처리했다.
좀 더 예쁘게 할 수도 있겠지만 bash 지식이 부족하여 일단 해결했다는데서 위안 삼기로 했다.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#!/bin/bash
</span><span style=color:#75715e></span>docker run -it --rm <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>-e PGAPPNAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$PGAPPNAME<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>-e PGUSER<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$PGUSER<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>-e PGPASSWORD<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$PGPASSWORD<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>-e PGDATABASE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$PGDATABASE<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>-e PGPORT<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$PGPORT<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>-e PGHOST<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$PGHOST<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>postgres psql <span style=color:#e6db74>&#34;</span>$@<span style=color:#e6db74>&#34;</span></code></pre></div></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83.0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><path d="M7 7V7z"/></svg><span class=tag><a href=https://thefron.me/tags/heroku>heroku</a></span><span class=tag><a href=https://thefron.me/tags/docker>docker</a></span><span class=tag><a href=https://thefron.me/tags/postgres>postgres</a></span><span class=tag><a href=https://thefron.me/tags/psql>psql</a></span></p></div><div id=comments class=thin><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"thefron"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></main></div></body></html>